<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>SirsiDynix Web2 Single Sign-on - EZProxyWiki</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.21.0rc5" />
<link rel="shortcut icon" href="https://pluto.potsdam.edu/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="https://pluto.potsdam.edu/ezproxywiki/opensearch_desc.php" title="EZProxyWiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://pluto.potsdam.edu/ezproxywiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="EZProxyWiki Atom feed" href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="../load.php%3Fdebug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;*.css" />
<!--[if IE 6]><link rel="stylesheet" href="/ezproxywiki/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/ezproxywiki/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: ezpwikidb:resourceloader:filter:minify-css:7:bd176711d87effdb3a6ff09c19734297 */</style>

<script src="../load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SirsiDynix_Web2_Single_Sign-on","wgTitle":"SirsiDynix Web2 Single Sign-on","wgCurRevisionId":3880,"wgArticleId":1526,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Code"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"SirsiDynix_Web2_Single_Sign-on","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});;},{},{});
/* cache key: ezpwikidb:resourceloader:filter:minify-js:7:a02a7fa766593347c4dbb130a7c3803e */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-SirsiDynix_Web2_Single_Sign-on skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">SirsiDynix Web2 Single Sign-on</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From EZProxyWiki</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="SirsiDynix_Web2_Single_Sign-on.html#column-one">navigation</a>, <a href="SirsiDynix_Web2_Single_Sign-on.html#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="SirsiDynix_Web2_Single_Sign-on.html#Requirements"><span class="tocnumber">1</span> <span class="toctext">Requirements</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="SirsiDynix_Web2_Single_Sign-on.html#EZproxy_Configuration"><span class="tocnumber">2</span> <span class="toctext">EZproxy Configuration</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="SirsiDynix_Web2_Single_Sign-on.html#Webserver_.2F_Web2_Configuration"><span class="tocnumber">3</span> <span class="toctext">Webserver / Web2 Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="SirsiDynix_Web2_Single_Sign-on.html#catalog.sso"><span class="tocnumber">3.1</span> <span class="toctext">catalog.sso</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="SirsiDynix_Web2_Single_Sign-on.html#Unicorn_Changes"><span class="tocnumber">4</span> <span class="toctext">Unicorn Changes</span></a></li>
</ul>
</td></tr></table>
<h3> <span class="mw-headline" id="Requirements">Requirements</span></h3>
<ul><li>EZproxy 4.0b or greater
</li><li>SirsiDynix Unicorn GL3.0 or greater
</li><li>SirsiDynix Web2 GL3.1 or greater
</li><li>Webserver running a version of PHP that supports the use of the exec command
</li></ul>
<h3> <span class="mw-headline" id="EZproxy_Configuration">EZproxy Configuration</span></h3>
<p>The first step in using EZproxy to perform single sign-on (SSO) for SirsiDynix Web2 is to setup a configuration entry and secret key used for communicating between the webserver and EZproxy.  This is accomplished by using the following line in <i>ezproxy.cfg</i>.   
</p>
<pre>SSO -Secret=***oursecret*** -URL=http://www.example.edu/catsso.php CA1</pre>
<p>In place of <i>***oursecret***</i>  you should use a relatively secure phrase or sequence of numbers and letters.  I use <a rel="nofollow" class="external free" href="http://grc.com/passwords/">http://grc.com/passwords/</a> to generate this entry for our library. The longer the string used, the shorter the overall URL can be due to a limitation in certain browsers.   The URL entry on this configuration line must be the same as the script created in step 3.  The final parameter “CA1” is a unique identifier for this SSO configuration line in EZproxy and is used to generate the appropriate SSO login url.
</p>
<h3> <span class="mw-headline" id="Webserver_.2F_Web2_Configuration">Webserver / Web2 Configuration</span></h3>
<p>Next, place the ezproxy php support library <i>ezproxysso.php</i> on your webserver, preferably somewhere in the php include path.  This file can be downloaded from OCLC at <a rel="nofollow" class="external free" href="http://www.oclc.org/us/en/support/documentation/ezproxy/usr/sso/phpsso.tar">http://www.oclc.org/us/en/support/documentation/ezproxy/usr/sso/phpsso.tar</a>
</p><p>You will now need to create a wrapper script for tramp2.exe that handles triggering the SSO attempt.  I have included 'catalogsso.php' as an example that has been working for us.  Your mileage may vary.    
</p><p>Now change the HTML in Web2 that would normally be used to access the 'MyAccount_Intro.html' page to instead point to your SSO php page.
</p>
<h4> <span class="mw-headline" id="catalog.sso">catalog.sso</span></h4>
<pre>
&lt;?php
  start_session();
/* By using the php session variable, you can store the user name in the php session and then have it available to other php pages w/o requiring additional logins. */

  require(&quot;ezproxysso.php&quot;);

/* Create new EZ Proxy SSO Object */
  $EZproxySSO = new EZproxySSO(
    '***oursecret***', 'https://ezproxy.example.com/sso/CA1');
    
  if (! $EZproxySSO-&gt;valid()) {
    if ($EZproxySSO-&gt;expired()) {
	  header (&quot;Location: &quot; .$_SERVER['PHP_SELF']);
    } else {
      header (&quot;Location: http://www.example.com/catalog/&quot;);
    }
    exit();
  }

/* uppercase the username so it will match our patron database */
  $user = strtoupper($EZproxySSO-&gt;user());

/* At this point you can save the user name to the PHP session for later use */


/* Setup the environment variables needed by web2 */	
  putenv('SERVER_NAME='. $_SERVER['SERVER_NAME']); 
  putenv('SERVER_PORT='. $_SERVER['SERVER_PORT']); 
  putenv('SERVER_PROTOCOL='. $_SERVER['SERVER_PROTOCOL']); 
  putenv('GATEWAY_INTERFACE='. $_SERVER['GATEWAY_INTERFACE']); 
  putenv('REQUEST_METHOD='. $_SERVER['REQUEST_METHOD']); 
  putenv('WEB2_REMOTE_USER=REMOTE_USER');
  putenv('REMOTE_USER='. $user); 
  putenv('PATH_INFO=/websso'); 
  putenv('SCRIPT_NAME=/web2/tramp2.exe');   

/* The following line (after QUERY_STRING=) should be customized to fit your Web2 environment */
  putenv('QUERY_STRING=setting_key=English&amp;servers=1home&amp;screen=MyAccount_Intro.html&amp;fail_screen=MyAccount_Intro.html');  

/* Call TRAMP2 and place the resulting output into $return_array */
  unset($return_array);
  exec('c:\SirsiWeb2\Web2\cgibin\tramp2.exe', $return_array, $return_val); 

  $skip = 1;
/* Display the output, skipping the headers output by ''tramp2.exe'', PHP has already generated headers due to start_session */

  while (list($key, $value) = each($return_array)) {
    if ($skip == 1) {
      $skip=0;
    } else {
      echo $value . &quot;\n&quot;;
    }
}
  
?&gt;
</pre>
<h3> <span class="mw-headline" id="Unicorn_Changes">Unicorn Changes</span></h3>
<p>Now, as long as you have populated the “WEB AUTH ID” field in Unicorn with the same login information used by EZproxy for authentication, your patrons should be able to login to their Web2 account automatically by using EZproxy.  In the case of the original author's institution, the patron's login name in LDAP was placed in the <i>WEB AUTH ID</i> field.
</p><p><a href="User:Cap60552.html" title="User:Cap60552">John Wohlers - Waubonsee Community College</a> 14:24, 23 February 2007 (EST)
</p>
<!-- 
NewPP limit report
Preprocessor visited node count: 37/1000000
Preprocessor generated node count: 64/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key ezpwikidb:pcache:idhash:1526-0!*!0!!en!*!* and timestamp 20150624201121 -->
</div><div class="printfooter">
Retrieved from "<a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;oldid=3880">https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;oldid=3880</a>"</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category:Code.html" title="Category:Code">Code</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<h2>Navigation menu</h2>
	<div id="p-cactions" class="portlet" role="navigation">
		<h3>Views</h3>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="SirsiDynix_Web2_Single_Sign-on.html" primary="1" context="subject" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=Talk:SirsiDynix_Web2_Single_Sign-on&amp;action=edit&amp;redlink=1" primary="1" context="talk" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;action=edit" primary="1" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;action=history" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal" role="navigation">
		<h3>Personal tools</h3>
		<div class="pBody">
			<ul>
				<li id="pt-createaccount"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=Special:UserLogin&amp;returnto=SirsiDynix+Web2+Single+Sign-on&amp;type=signup">Create account</a></li>
				<li id="pt-login"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=Special:UserLogin&amp;returnto=SirsiDynix+Web2+Single+Sign-on" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo" role="banner">
<a href="Main_Page.html" style="background-image: url(https://pluto.potsdam.edu/var/www/html/common/dot_trans.gif);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-portal"><a href="EZProxyWiki:Community_portal.html" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="EZProxyWiki:Current_events.html" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="Special:RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="Special:Random.html" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="Help:Contents.html" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet" role="search">
		<h3><label for="searchInput">Search</label></h3>
		<div id="searchBody" class="pBody">
			<form action="https://pluto.potsdam.edu/ezproxywiki/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" title="Search EZProxyWiki [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb" role="navigation">
		<h3>Toolbox</h3>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="Special:WhatLinksHere/SirsiDynix_Web2_Single_Sign-on.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="Special:RecentChangesLinked/SirsiDynix_Web2_Single_Sign-on.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
				<li id="t-permalink"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;oldid=3880" title="Permanent link to this revision of the page">Permanent link</a></li>
				<li id="t-info"><a href="https://pluto.potsdam.edu/ezproxywiki/index.php?title=SirsiDynix_Web2_Single_Sign-on&amp;action=info">Page information</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer" role="contentinfo">
	<div id="f-poweredbyico">
		<a href="https://www.mediawiki.org/"><img src="../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> This page was last modified on 21 July 2010, at 07:07.</li>
		<li id="viewcount">This page has been accessed 7,876 times.</li>
		<li id="privacy"><a href="EZProxyWiki:Privacy_policy.html" title="EZProxyWiki:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="EZProxyWiki:About.html" title="EZProxyWiki:About">About EZProxyWiki</a></li>
		<li id="disclaimer"><a href="EZProxyWiki:General_disclaimer.html" title="EZProxyWiki:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest","mediawiki.hidpi"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.207 secs. --></body></html>